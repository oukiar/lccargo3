<!DOCTYPE html><html ng-app="myApp">    <head>		        <meta http-equiv="content-type" content="text/html;charset=UTF-8" />        <meta charset="utf-8" />        <title>LC Cargo</title>        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />        <meta content="" name="description" />        <meta content="" name="author" />        		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=VT323">			   <!--ADMIN REQUIREMENTS-->     <% include ../../generals/ultraAdmin.ejs %>	    <script src="/cod/js/moment.js"></script>  <script src="/cod/js/common.js"></script>  <script src="/cod/js/jquery-1.11.2.min.js"></script>  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>          <script src="//www.parsecdn.com/js/parse-1.4.2.min.js"></script>	    </head>    <!-- END HEAD -->    <!-- BEGIN BODY -->    <body class=" ">		<!--START TOPBAR-->		 <% include ../../generals/topbar.ejs %>		         <!-- START CONTAINER -->        <div class="page-container row-fluid">        <!-- SIDEBAR - START -->            <!--  SIDEBAR - END -->	            <!-- START CONTENT -->       <section class="wrapper" style='display:inline-block;width:100%;'>          <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>             <div class="page-title">		  			  <% include partitions/Menu.ejs%>              <h1 class="title"  style="font-family: 'VT323', serif; font-size:50px; padding-left:13px;">Air - Not Processed</h1>			 <div id="content">		   	  <% include partitions/aeroTable.ejs%>                       </div>                     </div>              </div>          </section>      <!-- END CONTENT -->      </div><!-- END CONTAINER --></div>        </div><!-- END CONTAINER -->        <!-- LOAD FILES AT PAGE END FOR FASTER LOADING --><%include ../../generals/endFiles.ejs%><!-- DETALLE DE BOXES EN RECEIPT DE REPACK--><div id="openReceiptBoxesRepack" class="modalDialog">    <div>        <a href="#close" title="Close" class="closeB">X</a>        <div id="receipt_boxes">            <h2 class="title">Boxes contained in receipt# <font id="receiptBoxesRepack"></font></h2>            <div style="overflow:scroll; height:400px; vertical-align: top;">                <table id="boxes_Repacktable" name="boxes_table" class="table table-bordered">                    <thead>                        <tr>                            <td>                                Status                            </td>                            <td>                                Length                            </td>                            <td>                                Width                            </td>                            <td>                                Height                            </td>                            <td>                                Box Id                            </td>                            <td>                                RPrice                            </td>                        </tr>                    </thead>                    <tbody>                    </tbody>                </table>            </div>            <a href="#close" id="btn_doneboxes" class="pure-button pure-button-primary">Close</a>                        <a id="btn_unpack" class="pure-button pure-button-primary" href="#close" style="background:#E08566;">                <b>UNPACK !</b>            </a>	                    </div>    </div></div>	        <script>    Parse.initialize("XEPryFHrd5Tztu45du5Z3kpqxDsweaP1Q0lt8JOb", "MDhb1hBngr2tx2v9TjyzoUhMcOFeWGJ56TWvChqi");            /* GLOBAL USER */    var user;    /* OBTENCION Y ALMACENAMIENTO DEL CURRENT USER PARA USARSE CLIENTSIDE */    var query = new Parse.Query("User");        query.descending('createdAt');    query.include("Company");        query.get("<%= user.id%>", {        success:             function(object)            {                /* SAVE USER FOR FUTURE OPERATIONS */                user = object;            }            });        function update_table()        {                     if($("#warehousefilter").val() == "All")            {                dict_conditions = {filterby:"filterby",                                                             searchtext:"searchtext",                                                             filterdate:"filterdate",                                                            conditions:{containedIn:{"Status":["Repack"]},                                                                            equalTo:{Shipment:"Aereal",                                                                                "Company":{__type: "Pointer", className: "Companies", objectId: user.get("Company").id}}                                                                            }                                                                }            }            else            {                dict_conditions = {filterby:"filterby",                                                             searchtext:"searchtext",                                                             filterdate:"filterdate",                                                            conditions:{containedIn:{"Status":["Repack"]},                                                                            equalTo:{Shipment:"Aereal",                                                                                Warehouse:{__type: "Pointer", className: "Cellars", objectId: $("#warehousefilter").val()},                                                                                "Company":{__type: "Pointer", className: "Companies", objectId: user.get("Company").id}}                                                                            }                                                                }            }                        /*alert( JSON.stringify(dict_conditions) );*/                                    InsertTable({                    cols:                         {                            "ReceiptNum":"",                            "Consignee":{Name:""},                             "Weight":"",                            "Content":"",                            "TotalBoxes":"",                            "Agent":"",                            "Value":"",                            "objectId":""                        },                    collection: "Receipts",                                         conditions: filter_conditions_with_dict(dict_conditions),                                        like: filter_like("filterby", "searchtext"),                    document: "Staff/Air/partitions/aeroTableDynamic",                    itemid: "aeroTableDynamic"                });                               }                $("#btn_unpack").click(    function()    {                       /* DELETE THE REPACK */        var query = new Parse.Query("Receipts");        query.get(openedreceipt, {success:function(receipt){                            receipt.destroy();                                /* FIND THE BOXES THAT WAS REPACKED IN THIS REPACK */                var query = new Parse.Query("Boxes");                query.include("Receipt");                query.equalTo("PackedIn", {__type: "Pointer", className: "Receipts", objectId: openedreceipt});                                query.find({success:function(results){                                                                                    /* MARK THE BOXES AS RECEIVED */                        for(i in results)                        {                            results[i].set("Status", "Received");                        }                                                Parse.Object.saveAll(results, {success: function(results){                                /*  UPDATE PACKEDBOXES OF ORIGINAL RECEIPTS */                                                            for(i in results)                                {                                    var q = new Parse.Query("Boxes");                                    q.equalTo("Receipt", {__type: "Pointer", className: "Receipts", objectId: results[i].get("Receipt").id});                                    q.equalTo("Status", "Received");                                    q.include("Receipt");                                                                        q.find({success: function(results2){                                            /*alert(results.length);*/                                                                                        /* check here, maybe is not correct loop all items */                                            for(i in results2)                                            {                                                results2[i].get("Receipt").set("PackedBoxes", results2[i].get("Receipt").get("TotalBoxes")-results2.length);                                                results2[i].get("Receipt").save();                                            }                                                                                                                                }});                                }                                                            update_table();                                alert("Unpack done!");                                                        }});                    }});            }});                                            return;    });        </script>    </body>	</html>
<!DOCTYPE html><html ng-app="myApp">    <head>		        <meta http-equiv="content-type" content="text/html;charset=UTF-8" />        <meta charset="utf-8" />        <title>LC Cargo</title>        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />        <meta content="" name="description" />        <meta content="" name="author" />        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=VT323">        <!--ADMIN REQUIREMENTS-->           <% include ../../generals/ultraAdmin.ejs %>        <script src="/cod/js/moment.js"></script>        <script src="/cod/js/common.js"></script>        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">        <script src="//code.jquery.com/jquery-1.10.2.js"></script>        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>        <link rel="stylesheet" href="/resources/demos/style.css">        <script src="//www.parsecdn.com/js/parse-1.4.2.min.js"></script>        <script>        $(function()         {            $( "#tabs" ).tabs();        });       </script>           <style>       #tabs        {         border:none;        }        #tabs ul        {            border:0;            background: white;        }        #tabs li        {            color:#FF7260;color:rgba(0,0,0,.8);border:2px solid #82939E;border:1 rgba(0,0,0,0);background-color:#eee;        }    </style>        </head>    <!-- BEGIN BODY -->    <body class=" ">		<!--START TOPBAR-->        <% include ../../generals/topbar.ejs %>        <!-- START CONTAINER -->        <div class="page-container row-fluid">        <!-- START CONTENT -->          <section class="wrapper" style='margin-top:50px; display:inline-block;width:100%;'>        <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>        <div class="page-title">        <div class="pull-left">                        <h1 class="title" style="font-family: 'VT323', serif; font-size:50px; padding-left:13px;">Store's Profile</h1>                <fieldset class="container">        <div class="row">            <div class="col-lg-12 col-md-12 container">                <div class="row">                    <div class="col-md-6 col-xs-6" style="margin-top:10px;">                        <div style="float:left;">	                        </div>                    </div>                                                <div class="col-md-6 col-xs-6" style="margin-top:10px;">                        <div style="float:right">	                            Search client: <input id="txt_name" name="txt_name">                        </div>                    </div>                </div>                                        <div id="profile_content">                    <div class="panel">                        <div class="panel-body">                            <div id="tabs" style="display:none">                                <ul>                                    <li><a href="#tabs-1"><font color="#82939E">Information</font></a></i>                                    <li><a href="#tabs-2"><font color="#82939E">Warehouse</font></a></li>                                </ul>                                                                      <div id="tabs-1">                                    <div id="tabprofile">                                                                            </br>                                        <table style="width:500px;" class="table table-bordered" id="blueRow">                                            <tr>                                                <th>Name:</th>                                                <td id="clientName"></td>                                            </tr>                                            <tr>                                                <th>Address:</th>                                                <td id="clientAddress"></td>                                            </tr>                                            <tr>                                                <th>Account ID:</th>                                                <td id="clientAccount"></td>                                            </tr>                                            <tr>                                                <th>State:</th>                                                <td id="clientState"></td>                                            </tr>                                            <tr>                                                <th>Country:</th>                                                <td id="clientCountry"></td>                                            </tr>                                            <tr>                                                <th>Zip:</th>                                                <td id="clientZip"></td>                                            </tr>                                            <tr>                                                <th>Email:</th>                                                <td id="clientEmail"></td>                                            </tr>                                            <tr>                                                <th>Telephone:</th>                                                <td id="clientTelephone"></td>                                            </tr>                                            <tr>                                                <th>Cellphone:</th>                                                <td id="clientCellphone"></td>                                            </tr>                                            <tr>                                                <th>ID:</th>                                                <td id="clientID"></td>                                            </tr>                                                                                    </table>                                                                        </div>                                </div>                                                                                    <div id="tabs-2">                                    <div id="tabwarehouses">                                                                            <table style="display:inline; position:relative; top:13px;">                                             <tr>                                                <th style="text-align: center;">Warehouse</th>                                                <th style="text-align: center;"><label for="filterby" class="pfont">By:</label></th>                                                <th></th>                                                <th style="text-align: center;"><label class="pfont">Date:</label></th>                                            </tr>                                            <tr>                                                <td style="padding: 13px;">                                                    <select  id="warehousefilter" name="warehousefilter">                                                        <option value="All">All</option>                                                    </select>                                                </td>                                                                                              <td style="padding: 8px;">                                                    <select  id="filterby" name="filterby">                                                    <option value="All">All</option>                                                    <option value="ReceiptNum">Receipt #</option>                                                    <option value="Destination">Destination</option>                                                </select>                                                </td>                                                                                                <td style="padding: 5px;">                                                     <!-- IF ALL OR DATE SELECTED THIS SEARCH INPUT IS NOT USE-->                                                    <input type="hidden" placeholder="Search"  id="searchtext" name="searchtext">                                                </td>                                                                                                 <td style="padding: 8px;">                                                <select id="filterdate" name="filterdate">                                                     <option value="">All</option>                                                     <option value="DateRange">Date Range</option>                                                     <option value="Today">Today</option>                                                     <option value="Yesterday">Yesterday</option>                                                     <option value="This week">This week</option>                                                     <option value="This month">This month</option>                                                     <option value="Last month">Last month</option>	                                                     <option value="Current year">Current Year</option>                                                </select>	                                                </td>		                                                  <td style="padding: 8px;">                                                      <input type="text" id="fromdate" style="display:none;" size="13">                                                  </td>                                                    <td style="padding: 8px;">                                                        <input type="text" id="todate" style="display:none;" size="13">                                                    </td>                                                                                              <td style="padding: 8px;">                                                    <button id="btn_search" class="pure-button pure-button-primary">Search</button>                                                </td>                                            </tr>                                        </table>                                                                                 <table style="margin-top: 20px;" class="table table-bordered" id="receiptsTable">                                            <style>                                                #not:nth-child(even) {background: white}                                                #not:nth-child(odd) {background: #FBFBFC}                                            </style>                                            <thead>                                                <tr>                                                    <th>Rcpt.</th>                                                    <th style="cursor:pointer;">Shipper <i id="orderby_shipper" class="fa fa-chevron-down" style="float:right;"></i></th>                                                    <th>Repacked</th>                                                    <th>Boxes</th>                                                    <th style="cursor:pointer;">Date <i id="orderby_date" class="fa fa-chevron-down" style="float:right;"></i></th>                                                    <th style="cursor:pointer;">Destination <i id="orderby_destination" class="fa fa-chevron-down" style="float:right;"></i></th>                                                    <th>Weight</th>                                                    <th>WareHouse</th>                                                </tr>                                            </thead>                                                                                        <tbody>                                            </tbody>                                        </table>                                                                            </div>                                </div>                             </div>                        </div>                    </div>                </div>                                                </div>        </div>        </fieldset>                            </div>        </div>        </div>        </section>    <!-- END CONTENT -->    </div><!-- END CONTAINER -->       <!-- modal end -->        <script>            if( window.location.href.indexOf("cloudbox.parseapp") !=-1 )            Parse.initialize("Slh0vzK6DCaarshvF1Vu0ku3Rx2hwDdTaYwW7DLU", "TkJgyQRuMqqKtzZ6bEjdESPiUZ6sVkg3QntIxmh7");        else            Parse.initialize("XEPryFHrd5Tztu45du5Z3kpqxDsweaP1Q0lt8JOb", "MDhb1hBngr2tx2v9TjyzoUhMcOFeWGJ56TWvChqi");    /* GLOBAL USER */    var user;    /* OBTENCION Y ALMACENAMIENTO DEL CURRENT USER PARA USARSE CLIENTSIDE */    var query = new Parse.Query("User");        query.descending('createdAt');    query.include("Company");        query.get("<%= user.id%>", {        success:             function(object)            {                /* SAVE USER FOR FUTURE OPERATIONS */                user = object;                        /* FILL THE WAREHOUSES SELECT FILTER */                var query = new Parse.Query("Cellars");                                query.equalTo("Company", {__type: "Pointer", className: "Companies", objectId: user.get("Company").id} );                query.descending('createdAt');                                query.find({                    success:                         function(results)                        {                            for(i in results)                            {                                                                wareselect = document.getElementById("warehousefilter");                                wareselect.options[wareselect.options.length] = new Option(results[i].get("Name"), results[i].id);                                                                /* too fill the warehouses transfer list */                                waretransfer = document.getElementById("waretransfer");                                waretransfer.options[waretransfer.options.length] = new Option(results[i].get("Name"), results[i].id);                                                            }                                                                                }                    });                            }        });    	$( "#txt_name" ).autocomplete({source: []});        $("#txt_name").keyup(		function(){			var myval = $("#txt_name").val();                        var query = new Parse.Query("Agencies");            query.descending('createdAt');            query.equalTo("Company", {__type: "Pointer", className: "Companies", objectId: user.get("Company").id} );            /*query.contains("name_lower", myval);*/            query.matches("Name", myval.toUpperCase(), 'i');            /*query.startsWith("Name", myval.toUpperCase());*/                        query.find({                success:                     function(results)                    {                        var newresult = [];                                                for(i in results)                            newresult.push({label:results[i].get("Name"), idx:results[i].id});                                                    $("#txt_name").autocomplete({source: newresult});                           $("#txt_name").trigger("keydown");                    }                });        });                                usrID = -1;                /*CLIENT SELECCION FROM THE RESULT*/        $( "#txt_name" ).autocomplete({             select: 			 function( event, ui )             {                usrID = ui.item.idx;                                var query = new Parse.Query("Agencies");                query.equalTo("objectId", usrID);                query.first({success: function(client){                        /* FILL THE PROFILE INFORMATION */                                                $("#clientName").text(client.get("Name") );                        $("#clientAddress").text(client.get("Address") );                        $("#clientAccount").text(client.get("Account") );                        $("#clientState").text(client.get("State") );                        $("#clientCountry").text(client.get("Country") );                        $("#clientZip").text(client.get("Zip") );                        $("#clientEmail").text(client.get("Email") );                        $("#clientTelephone").text(client.get("Telephone") );                        $("#clientCellphone").text(client.get("Cellphone") );                        $("#clientID").text(client.get("ID1") );                                                $("#tabs").show();                                                    update_table();                                  }});            }        });            var orderby = "ConsigneeName";            function update_table()    {            var query = new Parse.Query("Receipts");                        query.include("Shipper");            query.include("Consignee");            query.include("Warehouse");                        query.ascending(orderby);                        /* WAREHOUSE FILTER */            if($("#warehousefilter").val() != "All")                query.equalTo("Warehouse", {__type: "Pointer", className: "Cellars", objectId: $("#warehousefilter").val()});                        /* COMPANY */            query.equalTo("Company", {__type: "Pointer", className: "Companies", objectId: user.get("Company").id});                        /* ONLY THIS CONSIGNEE */            query.equalTo("Shipper", {__type:"Pointer", className:"Agencies", objectId:usrID});                        /* SECTION CONDITIONS ... RECEIPT LIST IN THIS CASE */            query.containedIn("Status", ["Received","NotProcessed"]);                            /* FILTERBY */            if($("#filterby").val() != "All")            {                switch($("#filterby").val())                {                    case "Shipper":                        var querymatch = new Parse.Query("Agencies");                        /*querymatch.startsWith("Name", $("#searchtext").val().toUpperCase());*/                        querymatch.matches("Name", $("#searchtext").val().toUpperCase(), i);                        query.matchesQuery("Shipper", querymatch);                        break;                    case "Consignee":                        var querymatch = new Parse.Query("Clients");                        querymatch.matches("Name", $("#searchtext").val().toUpperCase(), i);                        query.matchesQuery("Consignee", querymatch);                        break;                    case "ReceiptNum":                        query.equalTo("ReceiptNum", parseInt($("#searchtext").val()));                        break;                    case "Destination":                        /*querymatch.startsWith("Destination", $("#searchtext").val().toUpperCase());*/                        query.matches("Destination", $("#searchtext").val(), 'i');                        break;                }            }                        if($("#filterby").val() != "ReceiptNum")            {                        /* FILTER DATE */                if($("#filterdate").val() != "All")                {                    if($("#filterdate").val() == "DateRange")                    {                        var begindate = new Date($("#fromdate").val() );                        var enddate = new Date($("#todate").val() );                                                query.greaterThanOrEqualTo('ReceiptDate', moment( begindate ).format("YYYYMMDD"));                        query.lessThanOrEqualTo('ReceiptDate', moment( enddate).format("YYYYMMDD"));                                            }                    else                    {                        clientDateConditions(query);                    }                }            }                        query.find({success: function(results){                                    console.log( results.length + " rows returned");                                        lastrowcount = results.length;                    rowcounter = results.length;                                        totalboxes = 0;                    totalweight = 0;                                    $("#receiptsTable > tbody").html("");                                    for(i in results)                    {                        totalboxes += results[i].get("TotalBoxes");                        totalweight += parseInt(results[i].get("Weight"));                                                var destination = results[i].get("Destination");                        if( destination == null)                            destination = results[i].get("Consignee").get("Country");                                                    var hour = "";                        if(typeof(results[i].get("Hour") ) != "undefined")                            hour = results[i].get("Hour");                                                                        if(typeof(results[i].get("ShipperName"))!="undefined")                        {                            shippername = results[i].get("ShipperName");                        }                        else                        {                            shippername = results[i].get("Shipper").get("Name");                        }                                                                        if(typeof(results[i].get("ConsigneeName"))!="undefined")                        {                            consigneename = results[i].get("ConsigneeName");                        }                        else                        {                            consigneename = results[i].get("Consignee").get("Name");                        }                                                var row = "<tr><td>"+ results[i].get("ReceiptNum") +                                                                              "</td><td>"+shippername+                                    "</td><td align='center'><b>"+ results[i].get("PackedBoxes") +"</b>"+                                    "</td><td align='center'><b>"+ results[i].get("TotalBoxes") +"</b>"+                                    "</td><td>"+ moment(results[i].get("ReceiptDate"), "YYYYMMDD").format("MM/DD/YYYY") + " " + hour +                                    "</td><td>"+destination+                                    "</td><td>"+results[i].get("Weight")+                                    "</td><td><b>" + results[i].get("Warehouse").get("Name") + "</b></td></tr>";                                                            $("#receiptsTable > tbody").append(row);                    }                                        /*                    $("#totalBoxes").html(totalboxes.toString());                    $("#totalWeight").html(totalweight.toString());                    */                                        /*reactivatepopup();*/                                    }});    }                    </script>        			    <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->	    <%include ../../generals/endFiles.ejs%>    </body>	</html>
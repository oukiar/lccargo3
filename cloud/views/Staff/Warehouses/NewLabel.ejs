<!doctype html><html lang="en">    <head>                <meta http-equiv="content-type" content="text/html;charset=UTF-8" />        <meta charset="utf-8" />        <title>LC Cargo</title>        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />        <meta content="" name="description" />        <meta content="" name="author" />        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=VT323|Jura|EB+Garamond&amp;subset=all">        <link rel="stylesheet" href="cod/css/styleWareHouse.css">        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">                        <script src="//code.jquery.com/jquery-1.10.2.js"></script>        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>        <script src="//www.parsecdn.com/js/parse-1.4.2.min.js"></script>        <!-- QR CODE GENERATOR -->        <script type="text/javascript" src="/cod/js/jquery.qrcode.js"></script>        <script type="text/javascript" src="/cod/js/qrcode.js"></script>        <script src="/cod/js/moment.js"></script>        <script type="text/javascript" src="/cod/js/moment-timezone-with-data.min.js"></script>        <script src="/cod/js/base64.min.js"></script>        <script src="/cod/js/jspdf.min.js"></script>        <script src="https://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=places"></script>        <script src="cod/js/jquery.geocomplete.js"></script>        <!--ADMIN REQUIREMENTS-->           <% include ../../generals/ultraAdmin.ejs %>        <script src="/cod/js/common.js"></script>		<script>		function showClient(){			$("#newLabelForm").css('display', 'none');			$("#registerClient").css('display', '');			$("#registerStore").css('display', 'none');				$("#newreceiptClient").css('display', '');			$("#newreceiptStore").css('display', 'none');			}				function newReceipt(){			$("#newLabelForm").css('display', '');			$("#registerClient").css('display', 'none');			$("#registerStore").css('display', 'none');			$("#newreceiptClient").css('display', 'none');			$("#newreceiptStore").css('display', 'none');					}						function showStore(){			$("#newLabelForm").css('display', 'none');			$("#registerClient").css('display', 'none');			$("#registerStore").css('display', '');				$("#newreceiptStore").css('display', '');			$("#newreceiptClient").css('display', 'none');			}		        function hideClient(){			$("#newLabelForm").css('display', '');			$("#registerClient").css('display', 'none');			$("#registerStore").css('display', 'none');			$("#newreceiptClient").css('display', 'none');			$("#newreceiptStore").css('display', 'none');					}						function hideStore(){			$("#newLabelForm").css('display', '');			$("#registerClient").css('display', 'none');			$("#registerStore").css('display', 'none');				$("#newreceiptStore").css('display', 'none');			$("#newreceiptClient").css('display', 'none');			}        		</script>	    <style>		#geocomplete { width: 200px}		.map_canvas1 { 		  width:100%; 		  height: 100%;   		}		#multiple li { 		  cursor: pointer; 		  text-decoration: underline; 		}				#footer {		   position:fixed;		   bottom:0;		   width:100%;		   height:28px;   /* Height of the footer */		   background:#52646F;		}			</style>		        <!--<link rel="stylesheet" type="text/css" href="cod/labels/css/regCon2NewLabel.css">-->                <link rel="stylesheet" href="newReceiptRegister/css/site.20150806195824.css">            </head><body><!--START TOPBAR-->		 <% include ../../generals/topbar.ejs %>		         <!-- START CONTAINER -->        <div class="page-container row-fluid" style="position:relative; top:60px;">        <!-- START CONTENT -->        <section class="wrapper" style='display:inline-block;width:100%;'>    	 		      <div style="position:absolute; left:18%;" id="newLabelForm">        <% include newlabel_partitions/LabelForm.ejs %>	</div>		<section class="wrapper" style='margin-top:60px;display:inline-block;width:100%;padding:15px 0 0 15px; display:none;' id="registerClient">	 	   <div style="margin-left:13%; width:500px;position:relative; top:-100px;">                <% include newlabel_partitions/registerConsigneeForm.ejs %>	 	   </div>    </section>			    <section class="wrapper" style='margin-top:60px;display:inline-block;width:100%;padding:15px 0 0 15px; display:none;' id="registerStore">        <div style="margin-left:13%; width:500px; position:relative; top:-100px;">            <% include newlabel_partitions/registerStoreForm.ejs %>		        </div>    </section>			                  <!-- END CONTENT -->           <div id="openModalPrint" class="modalDialog">	        <div>            <a href="#close" title="Close" class="close">X</a>            <div id="modalmessage" style="margin-left:21%;">            <img src="/web/img/icons/loader_grey.gif">            </div>	</div></div>      	 		        </div><!-- END CONTAINER -->		  	  	<div id="footer">  	  		<div style="margin-left:5%; margin-top:2px;">  	  	<span class="title" style="color:white; cursor:pointer;" onclick="showClient()"><i class="fa fa-users" style="color:white;"></i> Register Consignee</span>  	  	<span class="" style="color:white; cursor:pointer; margin-left:2%;" onclick="showStore()"><i class="fa fa-arrow-right"></i> Register Shipper</span>	   <span class="" style="color:white; cursor:pointer; margin-left:2%;" onclick="newReceipt()"><i class="fa fa-tags" style="color:white;"></i> New Label</span>	   	     <span class="" style="color:white; cursor:pointer; margin-left:2%;" onclick="newReceipt()"><i class="fa fa-tags" style="color:white;"></i> JAVIER NO FUNCIONARA LO QUE ME DIJISTE AYER HASTA EN LA TARDE POR UNOS CAMBIOS QUE NECESITO HACER.</span>		   	  </div>  	  	</div>		        <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->        <%include ../../generals/endFiles.ejs%>        <!-- modal end --><script>                    var nwarehouses = 1;             $(function(){            var options = {                        };                     $("#geocomplete").geocomplete(options)              .bind("geocode:result", function(event, result){                  /*alert(JSON.stringify(result) );*/                               $.log(result);              })		                .bind("geocode:error", function(event, status){                /*$j.log("ERROR: " + status);*/              })                         .bind("geocode:multiple", function(event, results){                /*$j.log("Multiple: " + results.length + " results found");*/              });                  });                 $("#find").click(function(){            $("#geocomplete").val('');          });                        $.log = function(result){            var message = result.formatted_address;            var wareName = result["address_components"][0]["long_name"];                     var long_name;            var short_name;                     for( i in result["address_components"] )            {                if( $.inArray("country", result["address_components"][i]["types"]) > -1)                {                    wareName += " - " + result["address_components"][i]["long_name"];                    long_name = result["address_components"][i]["long_name"];                    short_name = result["address_components"][i]["short_name"];                    break;                }            }                     var logger = $("#logger");            logger.html(logger.html()+ "<tr><td style='white-space: nowrap; padding-top: 0px;' align='left'>" +                             "<a onclick='deleteRow(this)'>Delete</a>"  +                            "\n * " + message + "\n" + "<b><font color='#E08566'>Destination Name:</font></b>" + "\n" +                             "<input type='text' id='Alias" + nwarehouses.toString() + "' value='"+ wareName +                            "' placeholder='Destination Name' style='width:34%; background:white; height:34px;'><input type='hidden' value='" + message +                            "' id='Address"+ nwarehouses.toString() +"'>"+                              "<input type='hidden' id='Country"+ nwarehouses.toString() +"' value='"+ long_name +"'>" +                            "<input type='hidden' id='CountryCode"+ nwarehouses.toString() +"' value='"+ short_name +"'>" +                            "<input type='hidden' id='GeoCode"+ nwarehouses.toString() +"' value='"+ JSON.stringify(result) +"'></td></tr>");                                     nwarehouses += 1;                     $("#geocomplete").val('');			$("#clientAddress").val(result.formatted_address);            $("#clientAlias").val(wareName);            $("#clientCountry").val(long_name);            $("#clientCountryCode").val(short_name);            $("#clientGeoCode").val(JSON.stringify(result) );			          };		    		function deleteRow(btn) {  		  var row = btn.parentNode.parentNode;  		  row.parentNode.removeChild(row);  		}     /* STORE GEOCOMPLETION STUFF */        $(function(){        var options = {        };                $("#storeAddress").geocomplete(options)          .bind("geocode:result", function(event, result){                          $.logStore(result);          })                    .bind("geocode:error", function(event, status){                    })                    .bind("geocode:multiple", function(event, results){                    });             });                  $.logStore = function(result){            var wareName = result["address_components"][0]["long_name"];            var destination = result["address_components"][0]["long_name"];                        var long_name;            var short_name;                        for( i in result["address_components"] )            {                if( $.inArray("country", result["address_components"][i]["types"]) > -1)                {                    wareName += " - " + result["address_components"][i]["long_name"];                    long_name = result["address_components"][i]["long_name"];                    short_name = result["address_components"][i]["short_name"];                    break;                }            }                      $("#storeAddress").val(result.formatted_address);            $("#storeAlias").val(wareName);            $("#storeCountry").val(long_name);            $("#storeCountryCode").val(short_name);            $("#storeGeoCode").val(JSON.stringify(result) );                  };    /* REGISTRATION CLIENT PROCESS */    $("#btn_registerClient").click(function(){            var Clients = Parse.Object.extend("Clients");            var client = new Clients();                  consigneeEmail = $("#clientEmail").val();                  client.set("Name", $("#clientName").val() );            client.set("Email", $("#clientEmail").val() );            client.set("Telephone", $("#clientTelephone").val() );			client.set("Cellphone", $("#clientCellphone").val() );			client.set("AccountID", $("#clientAccountID").val() );			client.set("ID1", $("#clientID").val() );            client.set("Company", user.get("Company") );		                client.save({success:function(client){                                                    /* SAVE THE MULTIPLE DESTINATIONS */                    for(var nwh=1; nwh<10; nwh++)                    {                                            if(typeof($("#Alias" + nwh.toString()).val() ) === "undefined")                            continue;                                                    var Destinations = Parse.Object.extend("Destinations");                        var destination = new Destinations();                                                destination.set("Alias", $("#Alias" + nwh.toString() ).val() );                        destination.set("Address", $("#Address" + nwh.toString() ).val() );                        destination.set("Country", $("#Country" + nwh.toString() ).val() );                        destination.set("CountryCode", $("#CountryCode" + nwh.toString() ).val() );                        destination.set("GeoCode", $("#GeoCode" + nwh.toString() ).val() );                        destination.set("Client", client );                                                destination.save();                    }                                $("#Consignee").val(client.get("Name") );                                        fillDestinations(client.id);                                        hideClient();                                                            /*                    var Destinations = Parse.Object.extend("Destinations");                    var destination = new Destinations();                                        destination.save({                            Alias: $("#clientAlias").val(),                            Address: $("#clientAddress").val(),                            Country: $("#clientCountry").val(),                            CountryCode: $("#clientCountryCode").val(),                            GeoCode: $("#clientGeoCode").val(),                            Client: client                        });*/                                                            }});        });    /* REGISTRATION STORE PROCESS */    $("#btn_registerStore").click(function(){            var Agencies = Parse.Object.extend("Agencies");            var agency = new Agencies();                        agency.set("Name", $("#storeName").val() );            agency.set("Email", $("#storeEmail").val() );            agency.set("Telephone", $("#storeTelephone").val() );            agency.set("Address", $("#storeAddress").val() );            agency.set("Country", $("#storeCountry").val() );			agency.set("AccountID", $("#agencyAccountID").val() );            agency.set("CountryCode", $("#storeCountryCode").val() );            agency.set("GeoCode", $("#storeGeoCode").val() );                        agency.set("Company", user.get("Company") );                        agency.save({success:function(agency){                                                        /* SHOW THE NEWLABEL FORM WITH THE STORE PRE-SELECTED */                                        $("#Shipper").val(agency.get("Name") );                                        shipperID = agency.id;                                        $("#storeNameInfo").html(agency.get("Name") );                    $("#storeCountryInfo").html(agency.get("Country") );                    $("#storeEmailInfo").html(agency.get("Email") );                    $("#storeTelephoneInfo").html(agency.get("Telephone") );                    $("#storeAddressInfo").html(agency.get("Address") );                    $("#storeWebsiteInfo").html(agency.get("Website") );                    $("#storeStatusInfo").html(agency.get("Status") );                                        hideClient();                }});        });    </script><script>    if( window.location.href.indexOf("cloudbox.parseapp") !=-1 )        Parse.initialize("Slh0vzK6DCaarshvF1Vu0ku3Rx2hwDdTaYwW7DLU", "TkJgyQRuMqqKtzZ6bEjdESPiUZ6sVkg3QntIxmh7");    else        Parse.initialize("XEPryFHrd5Tztu45du5Z3kpqxDsweaP1Q0lt8JOb", "MDhb1hBngr2tx2v9TjyzoUhMcOFeWGJ56TWvChqi");    /* GLOBAL USER */    var user;    /* OBTENCION Y ALMACENAMIENTO DEL CURRENT USER PARA USARSE CLIENTSIDE */    var query = new Parse.Query("User");        query.descending('createdAt');    query.include("Company");        query.get("<%= user.id%>", {        success:             function(object)            {                /*                alert("User retrieved: " + object.get("username") );                alert("Main cellar: " + object.get("CellarID").id );                */                                                /* SAVE USER FOR FUTURE OPERATIONS */                user = object;                                /* LLENADO DINAMICO DE SELECT DE BODEGAS DE ESTA EMPRESA */                var query = new Parse.Query("Cellars");                                query.equalTo("Company", {__type: "Pointer", className: "Companies", objectId: user.get("Company").id} );                query.ascending('createdAt');                                query.find({                    success:                         function(results)                        {                            for(i in results)                            {                                   wareselect = document.getElementById("Warehouse");                                wareselect.options[wareselect.options.length] = new Option(results[i].get("Name"), results[i].id);                            }                                                    }                    });                                            }        });                function fillDestinations(consigneID)        {            consigneeID = consigneID;            /* GET THE CLIENT OBJECT, WE NEED THE DESTINATIONS */            var query = new Parse.Query("Clients");            query.get(consigneeID, {                success:                    function(object)                    {                        /*destinations = object.get("Destinations");*/                        var query = new Parse.Query("Destinations");                        query.equalTo("Client", {__type: "Pointer", className: "Clients", objectId: object.id});                        query.find({success:function(results){                                    country = document.getElementById("Country");                                    country.options.length = 0;                                    /* DESTINATIONS */                                    for(i in results)                                    {                                        country.options[country.options.length] = new Option(results[i].get("Alias"), results[i].get("Alias"));                                    }                                    /* COUNTRY */                                    if(typeof(object.get("Country")) != "undefined" )                                        country.options[country.options.length] = new Option(object.get("Country"), object.get("Country"));                                    /* CUSTOM DESTINATION */                                    country.options[country.options.length] = new Option("Custom", "Custom");                                    $("#Country").change(function(){                                                                                if($("#Country").val() == "Custom")                                            {                                                $("#Country").hide();                                                $("#div_destination").show();                                            }                                        });                                }                            });                    }                });        }</script></body></html>
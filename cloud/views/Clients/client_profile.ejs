<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <meta charset="utf-8" />
    <title>LC Cargo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <% include ../generals/ultraAdmin.ejs %>
    <!--ADMIN REQUIREMENTS-->   

        <script src="/cod/js/moment.js"></script>
        <script src="/cod/js/common.js"></script>
        <script src="/cod/js/jquery-1.11.2.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
        <script src="//www.parsecdn.com/js/parse-1.4.2.min.js"></script>
        <script>
 /* 
    	 Parse.initialize("1MlFlpCslJWzRjZtFfSeUWDRXAS2zbszG2PuQ5Dd", "dREeQXyg3Zn7C8GG1eELLpaaBsGtI6A7BAVwA2sU");
  	  function updateClientInfo(){
		  var clientName = document.getElementById("clientName");
  		  Parse.Cloud.run('updateClientInfo', { clientName: clientName}, {
  		    success: function() {
  		  alert("success");
  		    },
  		    error: function() {
				alert("Error, please refresh the website and try again! Sorry! :(");
  		    }
  		  });
  	  }
	  */
	  
	  	  
  	  </script>
	 
	   
    </head>
    <!-- END HEAD -->
    <!-- BEGIN BODY -->
    <body>
 		<!--START TOPBAR-->

     <style>
     nav ul ul {
				display: none;
			  }

		   	nav ul li:hover > ul {
				display:block;
		   		position: absolute;
				width:100%;
			   	}
					
	nav ul li:hover {
				background: none;			
						}
					</style>
						 
			<nav class="navbar navbar-inverse" style="z-index:9999; background:#677A85;">
                   <div class="container-fluid" style="background:#52646F;">
                    <!-- Ultra Admin and toggle get grouped for better mobile display -->
                       <div class="navbar-header">
             <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-9">
                         <span class="sr-only">Toggle navigation</span>
                         <span class="icon-bar"></span>
                         <span class="icon-bar"></span>
                         <span class="icon-bar"></span>
                          </button>
                    </div>
               <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-9" style="z-index:9999;">
        <ul class="nav navbar-nav" style="z-index:9999;">
																
		 <li>
		 <a href="/profile">
		 <i class="fa fa-table" style="color:white;"></i>
		 <span class="title" style="color:white;">Warehouse</span><span class="arrow "></span>
		 </a>	 
		 </li>
      <li>
		 <a href="/client_profile" style="color:white;">
      <i class="fa fa-wrench" style="color:white;"></i>
	     <span class="title" style="color:white;">Profile</span>
		 </a>
		 </li>
	 <li>
		 <a href="/logout_staff" style="color:white;">
		 <i class="fa fa-lock" style="color:white;"></i>
		 <span class="title" style="color:white;">Logout</span>
		 </a>
		 </li>
	 </ul>
      </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
      </nav>
 		
        <!--  SIDEBAR - END -->	
        <!-- START CONTENT -->
        <div style="position:relative; left:144px;">
        <section class="wrapper" style='margin-top:60px;display:inline-block;width:100%;'>
            <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>
                <div class="page-title">
                    <div class="pull-left">
 			
                        <div style="position:relative; left:144px;">  
                            <h1 class="title">Personal Information</h1>
                        </div>
                        
                        <div style="margin-left:30%; width:500px;">
			  
                        <form name="clientEmails" action="/">
                            <div class="content-body">    
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">

                                       <div class="form-group">
                                           <label class="form-label" for="field-1">Full Name:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientName" name="clientName" value="<%= client.get('Name') %>" >
                                           </div>
                                       </div>
                                        
                                        <div class="form-group">
                                           <label class="form-label" for="field-1">Address:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientAddress" name="clientAddress" value="<%= client.get('Address') %>" >
                                           </div>
                                       </div>
                                        
                                        <div class="form-group">
                                           <label class="form-label" for="field-1">Account #:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientAccountID" name="clientAccountID" value="<%= client.get('AccountID') %>" >
                                           </div>
                                       </div>
                                       
                                        <div class="form-group">
                                           <label class="form-label" for="field-1">State:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientState" name="clientState" value="<%= client.get('State') %>" >
                                           </div>
                                       </div>
                                       
                                        <div class="form-group">
                                           <label class="form-label" for="field-1">Country:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientCountry" name="clientCountry" value="<%= client.get('Country') %>" >
                                           </div>
                                       </div>
                                       
                                        <div class="form-group">
                                           <label class="form-label" for="field-1">Zip code:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientZip" name="clientZip" value="<%= client.get('Zip') %>" >
                                           </div>
                                       </div>
                                       
                                        <div class="form-group">
                                           <label class="form-label" for="field-1">Cel:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientCel" name="clientCel" value="<%= client.get('Cellphone') %>" >
                                           </div>
                                       </div>
                                        <!--
                                       <div class="form-group">
                                           <label class="form-label" for="field-1">Language:</label>
                                           <div class="controls">
                                                <select  class="multi-select" id="clientLanguage" name="clientLanguage">
                                                <option value="Spanish">Spanish</option>
                                                <option value="English">English</option>
                                                </select>
                                           </div>
                                       </div>-->

                                       <div class="form-group">
                                           <label class="form-label" for="field-1">ID:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientID1" name="clientID1" value="<%= client.get('ID1') %>">
                                           </div>
                                       </div>

                                       <div class="form-group">
                                           <label class="form-label" for="field-1">Telephone:</label>
                                           <div class="controls">
                                               <input disabled maxlength="55" id="clientTelephone" name="clientTelephone" type="text" class="form-control"  value="<%= client.get('Telephone') %>">
                                           </div>
                                       </div>

                                       <div class="form-group">
                                           <label class="form-label" for="field-1">Email:</label>
                                           <div class="controls">
                                               <input disabled type="text" class="form-control" maxlength="55" id="clientEmail" name="clientEmail" value="<%= client.get('Email') %>" >
                                           </div>
                                       </div>
				  
	                   
                                        <!--
                                        <div class="form-group">
                                            <input type="button" id="btn_updateInformation" style="length:50px;" value="Update Information" class="pure-button pure-button-primary">
                                        </div>
                                        -->
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
	             
        </div>
		</div>
		
		
        <!-- START CONTENT -->
        <div style="position:relative; left:144px; top:5px;">
            <section class="wrapper" style='display:inline-block;width:100%;'>


                <div class="content-body">    
                    <div class="row" style="margin-left:30%; width:500px;">

                        <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>
                            <div class="page-title">
                                <div class="pull-left">
                    
                                    <div style="position:relative; left:144px;">  
                                        <h1 class="title">Destinations - Consignees</h1>
                                    </div>
                                    <!--<a href="#modalEditClient" id="btn_addconsignee"><img src="/web/img/icons/newtab.png" style="float:right; width:64px; height:64px;"></a>-->
                                    <table id="lst_consignees" style="width:100%;" class="table table-bordered" >
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Country</th>
                                                <!--<th>Actions</th>-->
                                            </tr>
                                        </thead>

                                        <tbody>
                                        </tbody>
                                    </table>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div><!-- END CONTAINER -->
	              <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->
	              <!-- modal end -->
				  
				  
            <!-- START CONTENT -->
        <div style="position:relative; left:144px; top:5px;">
            <section class="wrapper" style='display:inline-block;width:100%;'>
                <div class='col-lg-12 col-md-12 col-sm-12 col-xs-12'>
                    <div class="page-title">
                        <div class="pull-left">

                            <div style="position:relative; left:144px;">  
                                <h1 class="title">Password:</h1>
                            </div>
                            
                            <div style="margin-left:30%; width:500px;">

                                <div class="content-body">
                                    <div class="row">
                                        <div class="col-md-12 col-sm-12 col-xs-12">
                                            <div class="form-group">
                                                <label class="form-label" for="field-1">New Password:</label>
                                                <div class="controls">
                                                    <input type="password" class="form-control" maxlength="55" id="clientPassword" name="clientPassword"  >
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label" for="field-1">Re-type New Password:</label>
                                                <div class="controls">
                                                    <input type="password" class="form-control" maxlength="55" id="clientRTPassword" name="clientRTPassword"  >
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <input type="button" id="btn_changePassword" style="length:50px;" value="Change Password" class="pure-button pure-button-primary">
                                            </div>

                                        </div>
                                    </div>
                                </div>
                        
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
                
        <!-- END CONTENT -->
        </div><!-- END CONTAINER -->
        <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->
        <!-- modal end -->		  
        </div>
		

    <div id="modalEditClient" class="modalDialog">
        <a href="#close" title="Close" class="close">X</a>

        <div>
            <a href="#close" title="Close" class="closeB">X</a>
            <h3>Consignee Information</h3>
            
            <br>
            
            <table class="table table-bordered" id="blueRow">
                <tr>
                    <td><b>Name:</b></td><td id="tdCName" contenteditable='true'><div id='clientNameInfo'></div></td>
                </tr>
                <tr>
                    <td>
                        <b>Address</b>
                    </td>
                    <td id="tdCAddress" contenteditable='true'>
                        <div id="clientAddress"></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Account #</b>
                    </td>
                    <td id="tdCAccount" contenteditable='true'>
                        <div id="clientAccount"></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>State:</b>
                    </td>
                    <td id="tdCState" contenteditable='true'>
                        <div id='clientState'></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Country:</b>
                    </td>
                    <td id="tdCCountry" contenteditable='true'>
                        <div id='clientCountryInfo'></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Zip:</b>
                    </td>
                    <td id="tdCZip" contenteditable='true'>
                        <div id='clientZip'></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Cellphone:</b>
                    </td>
                    <td id="tdCCel" contenteditable='true'>
                        <div id='clientCel'></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Email:</b>
                    </td>
                    <td id="tdCEmail" contenteditable='true'>
                        <div id='clientEmailInfo'></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Telephone:</b>
                    </td>
                    <td id="tdCTel" contenteditable='true'>
                        <div id='clientTelephoneInfo'></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>ID:</b></td><td id="tdCID" contenteditable='true'>
                        <div id='clientIDInfo'></div>
                    </td>
                </tr>
                <!--<tr>
                <td><b>Destinations:</b></td><td id="tdCDest" contenteditable='false'><div id='clientDestinationInfo'></div></td>
                </tr>
                <tr>
                <td><b>Status:</b></td><td id="tdCStatus" contenteditable='false'><div id='clientStatusInfo'></div></td>
                </tr>-->
            </table>
            
            <a  href="#close" id="cancelConsignee" class="pure-button pure-button-primary" style="background:#E08566;">Cancel</a>
            <a href="#close" id="saveConsignee" class="pure-button pure-button-primary">Save</a>
        </div>

    </div>
    
		
    <%include ../generals/endFiles.ejs%>
	  
    <script>
         

    if( window.location.href.indexOf("cloudbox.parseapp") !=-1 )
        Parse.initialize("Slh0vzK6DCaarshvF1Vu0ku3Rx2hwDdTaYwW7DLU", "TkJgyQRuMqqKtzZ6bEjdESPiUZ6sVkg3QntIxmh7");
    else
        Parse.initialize("XEPryFHrd5Tztu45du5Z3kpqxDsweaP1Q0lt8JOb", "MDhb1hBngr2tx2v9TjyzoUhMcOFeWGJ56TWvChqi");


    /* GLOBAL USER */
    var user;

    /* OBTENCION Y ALMACENAMIENTO DEL CURRENT USER PARA USARSE CLIENTSIDE */
    var query = new Parse.Query("User");
    
    query.descending('createdAt');
    query.include("Company");
    query.include("ClientID");
    
    query.get("<%= Parse.User.current().id %>", {
        success: 
            function(object)
            {                
                /* SAVE USER FOR FUTURE OPERATIONS */
                user = object;
                
                
                update_consigneestable();
            }});
            
    $("#btn_addconsignee").click(function(){    
        
            $("#saveConsignee").html("Add");
            
            $("#tdCName").html("");
            $("#tdCAddress").html("");
            $("#tdCAccount").html("");
            $("#tdCState").html("");
            $("#tdCCountry").html("");
            $("#tdCZip").html("");
            $("#tdCCel").html("");
            $("#tdCEmail").html("");
            $("#tdCTel").html("");
            $("#tdCID").html("");
            
            return;
                
            $("#lst_consignees > tbody").append("<tr><td id='tdnewName' contenteditable></td><td id='tdnewCountry' contenteditable></td><td id='tdSave'><button id='btn_savenewConsignee'>SAVE</button></td></tr>");

            /* THE CLICK EVENT FOR THIS NEW CONSIGNEE */
            $("#btn_savenewConsignee").click(function(){
                                            
                    alert("SAVING");
                    
                    $("#tdnewName").attr('contentEditable', false);
                    $("#tdnewCountry").attr('contentEditable', false);
                    
                    var clientid = "00";
                    
                    $("#tdSave").html("<a href='#modalEditClient' onclick='onEditClient(\""+ clientid +
                                                                "\")' class='btn btn-border btn-orange'>"+
                                                                "<i class='fa fa-pencil-square-o'></i> Edit</a><a class='btn btn-border btn-danger' onclick='byeByeConsignee(\""+clientid+"\")'><i class='fa fa-trash-o'></i></a>");
                                                                
                    alert("SAVED");
                });

        });
        

         
     $("#btn_updateInformation").click(function(){
            
            var Client = Parse.Object.extend("Clients");
            var client = new Client();
            
            client.id = user.get("ClientID").id;
            
            client.set("Name", $("#clientName").val() );
            client.set("Address", $("#clientAddress").val() );
            client.set("AccountID", $("#clientAccountID").val() );
            client.set("State", $("#clientState").val() );
            client.set("Country", $("#clientCountry").val() );
            client.set("Zip", $("#clientZip").val() );
            client.set("Cellphone", $("#clientCel").val() );
            client.set("Language", $("#clientLanguage").val() );
            client.set("ID1", $("#clientID1").val() );
            client.set("Telephone", $("#clientTelephone").val() );
            client.set("Email", $("#clientEmail").val() );
            
            client.save({success: function(){alert("SAVED");}});
            
         });
        
        var consigneeID = -1;
        
        function onEditClient(objectId)
        {
            $("#saveConsignee").html("Save");
            
            consigneeID = objectId;
        
            var query = new Parse.Query("Clients");
            
            query.get(objectId, {success: function(client){
                            
                    $("#tdCName").html(tryget(client.get("Name") ));
                    $("#tdCAddress").html(tryget(client.get("Address")));
                    $("#tdCAccount").html(tryget(client.get("AccountID")));
                    $("#tdCState").html(tryget(client.get("State")));
                    $("#tdCCountry").html(tryget(client.get("Country")));
                    $("#tdCZip").html(tryget(client.get("Zip")));
                    $("#tdCCel").html(tryget(client.get("Cellphone")));
                    $("#tdCEmail").html(tryget(client.get("Email")) );
                    $("#tdCTel").html(tryget(client.get("Telephone")));
                    $("#tdCID").html(tryget(client.get("ID1")));
                    /*$("#tdCDest").html(tryget(client.get("Name"));*/
                    /*$("#tdCStatus").html(tryget(client.get("Status")));*/
                }});
            
        }

        
        $("#cancelConsignee").click(function(){
                $("#tdCName").text("");
                $("#tdCAddress").text("");
                $("#tdCAccount").text("");
                $("#tdCState").text("");
                $("#tdCCountry").text("");
                $("#tdCZip").text("");
                $("#tdCCel").text("");
                $("#tdCID").text("");
                $("#tdCTel").text("");
                $("#tdCEmail").text("");
            });
                    
        $("#saveConsignee").click(function(){
                
                var Client = Parse.Object.extend("Clients");
                var client = new Client();
                
                if($("#saveConsignee").html() == "Save")
                    client.id = consigneeID;
                else
                    client.set("MainClient", {__type:"Pointer", className:"Clients", objectId:user.get("ClientID").id} );
                
                client.set("Name", $("#tdCName").text() );
                client.set("Address", $("#tdCAddress").text() );
                client.set("AccountID", $("#tdCAccount").text() );
                client.set("State", $("#tdCState").text() );
                client.set("Country", $("#tdCCountry").text() );
                client.set("Zip", $("#tdCZip").text() );
                client.set("Cellphone", $("#tdCCel").text() );
                client.set("ID1", $("#tdCID").text() );
                client.set("Telephone", $("#tdCTel").text() );
                client.set("Email", $("#tdCEmail").text() );
                
                client.save({success: function(client){
                        alert("SAVED");
                        update_consigneestable();
                    }, error:function(){
                        alert("Error in " + $("#saveConsignee").html());
                    }});
                
            });
            
        function update_consigneestable()
        {

            /* LLENAR LISTA DE CONSIGNEES */
            var query = new Parse.Query("Clients");
            
            query.equalTo("MainClient", user.get("ClientID") );
            
            query.find({success:function(results){
                           
                    $("#lst_consignees > tbody").html("");
                                            
                    for(i in results)
                    {
                        $("#lst_consignees > tbody").append("<tr><td>"+ 
                                                        results[i].get("Name") +"</td><td>"+ 
                                                        results[i].get("Country") +"</td></tr>"); /*<td><a href='#modalEditClient' onclick='onEditClient(\""+ results[i].id +
                                                        "\")' class='btn btn-border btn-orange'>"+
                                                        "<i class='fa fa-pencil-square-o'></i> Edit</a><a class='btn btn-border btn-danger' onclick='byeByeConsignee(\""+results[i].id+"\")'><i class='fa fa-trash-o'></i></a></td></tr>");
                                                        */
                    }               
                }});
        }
        
        $("#btn_changePassword").click(function(){
                
                if($("#clientRTPassword").val() != $("#clientPassword").val() || $("#clientRTPassword").val()=="" || $("#clientPassword").val()=="")
                {
                    alert("Please verify your password");
                    return;
                }
                
                console.log("Saving");
                
                
                Parse.Cloud.run('updateUserPassword', 
                                {userId:user.id, newpass:$("#clientPassword").val()}, 
                                {success: function(result)
                                            {
                                                alert("Password updated");
                                            },
                                 error: function(){
                                                alert("Password reset, please login again");
                                                window.location = "/" + user.get("Company").get("companyLink");
                                            }});
                
                console.log("End save");
                
                /*
                user.set("password", $("#clientPassword").val());
                
                user.save({success:function(user){
                        alert("passwordchanged");
                    }});*/
                
            });
         
    </script>
	 
    </body>
</html>
